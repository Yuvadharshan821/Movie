<!DOCTYPE html>
<html>
<head>
    <title>Movies</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<h1 class="header">Movies</h1>

<div class="search-bar">
    <input id="search" type="text" placeholder="Search movies...">
</div>

<!-- SORT BUTTONS -->
<div class="sort-buttons">
    <button onclick="sortAZ()">A → Z</button>
    <button onclick="sortZA()">Z → A</button>
</div>

<div class="container" id="list"></div>

<script>
const API = "https://script.google.com/macros/s/AKfycbzmunyyjve54SpI3ILzEF9tctld7wRXEGN6NyUrTq6VX_IERfLZa_Z-ed2dAh30lID84A/exec";

let moviesData = []; // store movies globally

// LOAD movies
async function loadMovies() {
    const res = await fetch(API);
    const data = await res.json();
    moviesData = data.filter(item => item.category === "movie");
    displayMovies(moviesData);
}

function displayMovies(list) {
    const box = document.getElementById("list");
    box.innerHTML = "";

    list.forEach(m => {
        const div = document.createElement("div");
        div.className = "card";
        div.innerHTML = `
            ${m.title} 
            <button onclick="deleteItem('${m.title}')">Delete</button>
        `;
        box.appendChild(div);
    });
}

loadMovies();

// DELETE function
async function deleteItem(title) {
    if (!confirm(`Delete "${title}"?`)) return;

    const res = await fetch(`${API}?action=delete&title=${encodeURIComponent(title)}`);
    const data = await res.json();

    if (data.status === "deleted") {
        alert("Deleted Successfully!");
        loadMovies(); 
    } else {
        alert("Error: " + (data.message || "Try again"));
    }
}

// SORT A → Z
function sortAZ() {
    const sorted = [...moviesData].sort((a, b) =>
        a.title.localeCompare(b.title)
    );
    displayMovies(sorted);
}

// SORT Z → A
function sortZA() {
    const sorted = [...moviesData].sort((a, b) =>
        b.title.localeCompare(a.title)
    );
    displayMovies(sorted);
}

// SEARCH
document.getElementById("search").addEventListener("input", function() {
    const q = this.value.toLowerCase();
    document.querySelectorAll(".card").forEach(card => {
        card.style.display = card.textContent.toLowerCase().includes(q)
            ? "block" : "none";
    });
});
</script>

</body>
</html>
